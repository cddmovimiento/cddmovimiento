<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="sale_order_report_cdd_task">
            <t t-call="web.external_layout">
                <t t-if="address">
                    <div class="address row">
                        <t t-if="information_block">
                            <t t-set="colclass" t-value="'col-5 offset-1'"/>
                            <div name="information_block" class="col-6">
                                <t t-out="information_block"/>
                            </div>
                        </t>
                        <div name="address" t-att-class="colclass">
                            <t t-esc="address"/>
                        </div>
                    </div>
                </t>

                <div class="row">
                    <div class="col-3">

                    </div>
                    <div class = "col-6">
                        <h3 style = "text-align:center; font-weight: bold;">Reporte Diario de Operaciones</h3>
                    </div>
                </div>
                <br/>
                <div>                
                    <div style ="text-align:right; font-weight: bold;">
                        <t t-if="doc.get_binnacle_ids()"> Folio <span t-esc="doc.get_binnacle_ids()[0].folio"/></t>
                    </div>
                </div>                
                <br/>
                <div>
                    <table class = "table" style = "width:100%; border: none">
                        <tr>
                            <td width = "18%" style = "padding-bottom: 4px; padding-top: 1px; border: none; font-weight: bold;">Fecha: </td>
                            <td t-if = "doc.get_binnacle_ids()" style = "padding-bottom: 4px; padding-top: 1px;  border: none" width = "28%;"> <span t-esc="doc.get_binnacle_ids()[0].date_init.date()"/></td>
                            <td width = "18%" style = "padding-bottom: 4px; padding-top: 1px; border: none; font-weight: bold;">N° económico: </td>
                            <td t-if = "doc.get_binnacle_ids()" style = "padding-bottom: 4px; padding-top: 1px; border: none" width = "30%" colspam = "2"> <span t-field="doc.get_binnacle_ids()[0].vehicle_id.license_plate"/></td>
                        </tr>
                        <tr style = "border: none">
                            <td style = "padding-bottom: 4px; padding-top: 1px;border: none; font-weight: bold;">Cliente: </td>
                            <td style = "padding-bottom: 4px; padding-top: 1px;border: none" colspam = "2"><span t-field="doc.partner_id.name"/></td>
                            <td style = "padding-bottom: 4px; padding-top: 1px;border: none;font-weight: bold;">Horómetro inicial: </td>
                            <td t-if = "doc.get_binnacle_ids()"  style = "padding-bottom: 4px; padding-top: 1px;border: none"><span t-field="doc.get_binnacle_ids()[0].hourmeter_init"/></td>
                        </tr>

                        <tr style = "border: none">
                            <td style = "padding-bottom: 4px; padding-top: 1px;border: none; font-weight: bold;">Localización: </td>
                            <td style = "padding-bottom: 4px; padding-top: 1px;border: none" colspam = "2"><span t-field="doc.pozo"/></td>
                            <td style = "padding-bottom: 4px; padding-top: 1px;border: none; font-weight: bold;" >Horómetro final: </td>
                            <td t-if = "doc.get_binnacle_ids()" style = "padding-bottom: 4px; padding-top: 1px;border: none" > <span t-field="doc.get_binnacle_ids()[0].hourmeter_end"/> </td>
                        </tr>
                        <tr style = "border: none">
                            <td style = "padding-bottom: 4px; padding-top: 1px;border: none; font-weight: bold;" >Numero de orden: </td>
                            <td style = "padding-bottom: 4px; padding-top: 1px;border: none" colspam = "2"><span t-field="doc.sale_order_id.name"/></td>
                            <td style = "padding-bottom: 4px; padding-top: 1px;border: none; font-weight: bold;">Total horas: </td>
                            <td style = "padding-bottom: 4px; padding-top: 1px;border: none"><span t-esc="sum(l.delta_hourmeter for l in doc.get_binnacle_ids())"/></td>
                        </tr>
                    </table>
                    <div style="margin:auto; padding-bottom:7px!important; padding-top:7px!important; margin-top:18px!important; margin-bottom:18px; text-align:center; color:white; background-color:rgb(255,176,54); width:100%; border-radius:10px ;font-weight: bold;">CUADRILLA</div>
                    <div style="margin-top:5px ; margin-bottom:5px; border: none;">
                        <table style="width:100%; border: none;">
                            <tr>
                                <td style="border: none; font-weight: bold;">
                                    Gruero:
                                </td>
                                <td style="border: none" t-if="doc.get_binnacle_ids()">
                                    <t t-set="grueros" t-value="''"/>
                                    <t t-foreach="doc.get_binnacle_ids().sorted(key=lambda l: l.date_init)" t-as="line">
                                        <span t-if="line.gruero_id.name not in grueros">
                                            <thread>
                                                <t t-set='grueros' t-value="grueros +','+line.gruero_id.name"/>
                                            </thread>
                                            <a> <span t-field="line.gruero_id.name"/></a>
                                        </span>
                                    </t>
                                </td>
                            </tr>
                            <tr>
                                <td style="border: none; font-weight: bold;">
                                    Ayudante:
                                </td>
                                <td style="border: none" t-if="doc.get_binnacle_ids()">
                                    <t t-set="ayudantes" t-value="''"/>
                                    <t t-foreach="doc.get_binnacle_ids().sorted(key=lambda l: l.date_init)" t-as="line">
                                        <span t-if="line.ayudante_id.name not in ayudantes">
                                            <thread>
                                                <t t-set='ayudantes' t-value="ayudantes +','+line.ayudante_id.name"/>
                                            </thread>
                                            <a> <span t-field="line.ayudante_id.name"/> </a>
                                        </span>
                                    </t>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <div style = "margin:auto; padding-bottom:7px!important; padding-top:7px!important; margin-top:18px!important; margin-bottom:18px; text-align:center; color:white; background-color:rgb(255,176,54); width:100%; border-radius:10px ;font-weight: bold;">DESCRIPCIÓN DEL TRABAJO</div>
                    <div style="margin-top:10px ; margin-bottom:5px">
                        <span t-field="doc.description"/>
                    </div>

                    <div style = "margin:auto; padding-bottom:7px!important; padding-top:7px!important; margin-top:18px!important; margin-bottom:18px; text-align:center; color:white; background-color:rgb(255,176,54); width:100%; border-radius:10px ;font-weight: bold;">TIEMPO</div>
                    <div>
                        <table style = "width:100% ; border: 1px solid black !important ;" >
                            <thead>
                                <th width = "15%" style = "text-align:center;border-left: 1px solid black !important; border-right: 1px solid black !important">Inicio</th>
                                <th width = "15%" style = "text-align:center;border-left: 1px solid black !important; border-right: 1px solid black !important">Fin</th>
                                <th width = "15%" style = "text-align:center;border-left: 1px solid black !important; border-right: 1px solid black !important">Total</th>
                                <th width = "55%" style = "text-align:center;border-left: 1px solid black !important; border-right: 1px solid black !important">Operación</th>
                            </thead>
                            <tbody>
                                <t t-foreach="doc.get_binnacle_ids().sorted(key=lambda l: l.date_init)" t-as="line">
                                    <tr style = "border: 1px solid black !important">
                                        <td style = "text-align:center;border-left: 1px solid black !important; border-right: 1px solid black !important"><span t-field="line.date_init"/></td>
                                        <td style = "text-align:center;border-left: 1px solid black !important; border-right: 1px solid black !important"><span t-field="line.date_end"/></td>
                                        <td style = "text-align:center;border-left: 1px solid black !important; border-right: 1px solid black !important"><span t-field="line.delta"/></td>
                                        <td style = "text-align:center;border-left: 1px solid black !important; border-right: 1px solid black !important"><span t-field="line.comment"/></td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>

                     <div style = "margin-top:20px; margin-bottom:20px; border-radius:10px ;font-weight: bold; padding:5px">
                        <table style = "width:100%; border: none">
                            <tr style="border-radius:10px ;font-weight: bold; padding:5px">
                                <td width = "20%" style = "color: black; background-color: rgb(255,176,54) ;border-radius:10px ;font-weight: bold; padding:5px; text-align:center;border: none">CLIENTE</td>
                                <td style = "color: white; background-color: black; border-radius:10px ;font-weight: bold; padding:5px; text-align:right; border: none">Recibo de conformidad y satisfacción el servicio descrito en el presente reporte</td>
                            </tr>
                        </table>
                    </div>
                    <br/>
                    <div>
                        <table class = "table" style = "width:100%; border: none">
                            <tr style = "border: none; font-weight: bold;">
                                <td style = "border: none; font-weight: bold;">Nombre: _____________________________________________________</td>
                                <td style = "padding-bottom: 4px; padding-top: 1px;border: none; font-weight: bold;">Ayúdanos a mejorar tu experiencia, del 1 al 10 sieno 10 el mejor, ¿Cómo fue nuestro servicio?</td>
                            </tr>
                            <tr style = "border: none; font-weight: bold;">
                                <td style = "border: none; font-weight: bold;">Firma: _____________________________________________________</td>
                                <td style = "border: none;"><img class="img-fluid" src="/web/image/11706-3fc42486/sincolorear.PNG" style="width:500px; max-width: 500px; min-width: 500px;"/></td>
                            </tr>
                        </table>
                    </div>                                     
                </div>
            <t t-set="reset" t-value="docs.reset_binnacle_ids()"/>
            </t>
        </template>
        
        <record id="report_qweb_inherit" model="report.paperformat">
            <field name="name">Format inherit</field>
            <field name="default" eval="True" />
            <field name="orientation">Landscape</field>
            <field name="margin_top">35</field>
            <field name="margin_bottom">8</field>
            <field name="margin_left">5</field>
            <field name="margin_right">5</field>
            <field name="header_line" eval="False" />
            <field name="header_spacing">30</field>
            <field name="dpi">110</field>
        </record>
        
        <template id="sale_order_report_cdd_task_2">
            <t t-call="web.external_layout">
                <t t-if="address">
                    <div class="address row">
                        <t t-if="information_block">
                            <t t-set="colclass" t-value="'col-5 offset-1'"/>
                            <div name="information_block" class="col-6">
                                <t t-out="information_block"/>
                            </div>
                        </t>
                        <div name="address" t-att-class="colclass">
                            <t t-esc="address"/>
                        </div>
                    </div>
                </t>

                <div class="row">
                    <div class="col-3">

                    </div>
                    <div class = "col-6">
                        <h3 style = "text-align:center; font-weight: bold;">Resumen de Actividades</h3>
                    </div>
<!--                        <div class = "col-2" style = "border: 1px solid black !important ; border-radius: 10px; padding-top: 8px; margin-left: 77px; font-weight: bold;">
                        Folio :
                    </div>-->
                </div>
                <br/>
                <div>
                    <table class = "table">
                        <thead>
                            <th>Trabajo #</th>
                            <th>Grua #</th>
                            <th>Cliente</th>
                            
                            <th>Locacion</th>
                            <th>Inicio</th>
                            <th>Final</th>
                            
                            <th>Total dias</th>
                            <th>Total Horas</th>
                            <th>Detalle</th>
                            
                            <th>Precio</th>
                            <th>Cantidad</th>
                            <th>Sub Total</th>
                            
                            <th>IVA</th>
                            <th>Total</th>
                            <th>Estatus de Pagado</th>
                            <th>Estatus</th>
                            <th>Estatus operativo</th>
                            <th>Operador de Grua</th>
                            
                            <th>Ayudante Grua</th>
                            <th>Horas Generadas</th>
                        </thead>
                        <tbody>
                            <!--t t-set="num_ec" t-value="N/A"/-->
                            <t t-foreach="docs.sorted(lambda x: x.name , reverse = True)" t-as="doc">
                                
                                
                                
                                
                                
                                
<!--                                 filtro state -->
                                <t t-if = "docs.sorted(key=lambda r: r.id)[0].type_filtered == 'state'" >
                                    <t t-if = "docs.sorted(key=lambda r: r.id)[0].state_wizard == doc.state " >
                                        <t t-if="doc.tasks_ids">
                                            <t t-set="num_ec" t-value="doc.tasks_ids[0].vehicle_id.x_studio_numero_economico" />
                                        </t>
                                        <t t-if="doc.invoice_ids">
                                            <t t-set="paid_status" t-value="doc.invoice_ids[0].payment_state"/>
                                        </t>
                                        <t t-foreach="doc.order_line" t-as="line">
                                            
                                            <t t-set="date_init" t-value="'Sin bitacora'"/>
                                            <t t-set="date_end" t-value="'Sin bitacora'"/>

                                            <t t-if="doc.tasks_ids and doc.tasks_ids[0].binacle_ids" t-set="date_init" t-value="doc.get_date_init(line)"/>
                                            <t t-if="doc.tasks_ids and doc.tasks_ids[0].binacle_ids" t-set="date_end" t-value="doc.get_date_end(line)"/>
                                            
                                            <tr>
                                                <td style = "border: 1px solid black;"><span t-field="doc.name"/></td>
                                                <td style = "border: 1px solid black;"> <span t-esc="num_ec"/> </td>
                                                <td style = "border: 1px solid black;"> <span t-field="doc.partner_id.name"/> </td>

                                                <td style = "border: 1px solid black;">  <span t-if="doc.tasks_ids" t-field="doc.tasks_ids[0].partner_id.x_studio_ubicacin"/> </td>
                                                <td style = "border: 1px solid black;"> <span  t-esc="date_init"/> </td>
                                                <td style = "border: 1px solid black;"> <span t-esc="date_end"/> </td>

                                                <td style = "border: 1px solid black;"><span t-if="doc.tasks_ids and doc.tasks_ids[0].binacle_ids" t-esc="doc.get_days_total(line)"/>    </td>
                                                <td style = "border: 1px solid black;"><span t-if="doc.tasks_ids and doc.tasks_ids[0].binacle_ids" t-esc="doc.get_total_hours(line)"/>    </td>
                                                <td style = "border: 1px solid black;"> <span t-field="line.name"/> </td>
                                                <td style = "border: 1px solid black;"> <span t-field="line.price_unit"/> </td>
                                                <td style = "border: 1px solid black;"> <span t-field="line.product_uom_qty"/> </td>
                                                <td style = "border: 1px solid black;"> <span t-field="line.price_subtotal"/> </td>
                                                <td style = "border: 1px solid black;"><span t-field="line.price_tax"/></td>
                                                <td style = "border: 1px solid black;"><span t-esc="line.price_tax + line.price_subtotal"/></td>
                                                <td style = "border: 1px solid black;"><span t-esc="doc.get_status_invoice_paid(paid_status)"/>  </td>
                                                <td style = "border: 1px solid black;"> <span t-field="doc.state"/> </td>
                                                <td style = "border: 1px solid black;"> <span t-if="doc.tasks_ids" t-field="doc.tasks_ids[0].stage_id.name"/></td>
                                                <td style = "border: 1px solid black;"><span t-esc="doc.get_names_users_assigned()"/></td>
                                                <td style = "border: 1px solid black;"><span t-esc="doc.get_names_users_assigned()"/></td>
                                                <td style = "border: 1px solid black;">  <span t-esc="line.product_id.minimum_quantity"/> </td>
                                            </tr>
                                        </t>
                                    </t>
                                </t>
                                
                                
                                <!--                                 filtro unidad -->
                                
                                <t t-if = "docs.sorted(key=lambda r: r.id)[0].type_filtered == 'uni_eco'" >
                                    <t t-if = "doc.tasks_ids and doc.tasks_ids[0].vehicle_id">
                                        <t t-if = "docs.sorted(key=lambda r: r.id)[0].vehicle_wizard_id.id == doc.tasks_ids[0].vehicle_id.id " >
                                            <t t-if="doc.tasks_ids">
                                                <t t-set="num_ec" t-value="doc.tasks_ids[0].vehicle_id.x_studio_numero_economico" />
                                            </t>
                                            <t t-if="doc.invoice_ids">
                                                <t t-set="paid_status" t-value="doc.invoice_ids[0].payment_state"/>
                                            </t>
                                            <t t-foreach="doc.order_line" t-as="line">
                                                
                                                <t t-set="date_init" t-value="'Sin bitacora'"/>
                                                <t t-set="date_end" t-value="'Sin bitacora'"/>

                                                <t t-if="doc.tasks_ids and doc.tasks_ids[0].binacle_ids" t-set="date_init" t-value="doc.get_date_init(line)"/>
                                                <t t-if="doc.tasks_ids and doc.tasks_ids[0].binacle_ids" t-set="date_end" t-value="doc.get_date_end(line)"/>
                                                
                                                
                                                <tr>
                                                    <td style = "border: 1px solid black;"><span t-field="doc.name"/></td>
                                                    <td style = "border: 1px solid black;"> <span t-esc="num_ec"/> </td>
                                                    <td style = "border: 1px solid black;"> <span t-field="doc.partner_id.name"/> </td>

                                                    <td style = "border: 1px solid black;"> <span t-if="doc.tasks_ids" t-field="doc.tasks_ids[0].partner_id.x_studio_ubicacin"/> </td>
                                                    <td style = "border: 1px solid black;"> <span  t-esc="date_init"/> </td>
                                                    <td style = "border: 1px solid black;"> <span t-esc="date_end"/> </td>

                                                    <td style = "border: 1px solid black;"><span t-if="doc.tasks_ids and doc.tasks_ids[0].binacle_ids" t-esc="doc.get_days_total(line)"/>    </td>
                                                    <td style = "border: 1px solid black;"><span t-if="doc.tasks_ids and doc.tasks_ids[0].binacle_ids" t-esc="doc.get_total_hours(line)"/>    </td>
                                                    <td style = "border: 1px solid black;"> <span t-field="line.name"/> </td>
                                                    <td style = "border: 1px solid black;"> <span t-field="line.price_unit"/> </td>
                                                    <td style = "border: 1px solid black;"> <span t-field="line.product_uom_qty"/> </td>
                                                    <td style = "border: 1px solid black;"> <span t-field="line.price_subtotal"/> </td>
                                                    <td style = "border: 1px solid black;"><span t-field="line.price_tax"/></td>
                                                    <td style = "border: 1px solid black;"><span t-esc="line.price_tax + line.price_subtotal"/></td>
                                                    <td style = "border: 1px solid black;"><span t-esc="doc.get_status_invoice_paid(paid_status)"/>  </td>
                                                    <td style = "border: 1px solid black;"> <span t-field="doc.state"/> </td>
                                                    <td style = "border: 1px solid black;"> <span t-if="doc.tasks_ids" t-field="doc.tasks_ids[0].stage_id.name"/></td>
                                                    <td style = "border: 1px solid black;"><span t-esc="doc.get_names_users_assigned()"/></td>
                                                    <td style = "border: 1px solid black;"><span t-esc="doc.get_names_users_assigned()"/></td>
                                                    <td style = "border: 1px solid black;">  <span t-esc="line.product_id.minimum_quantity"/> </td>
                                                </tr>
                                            </t>
                                        </t>
                                    </t>
                                </t>
                                
                                
                                <!--                                 fecha creacion -->
                                
                                <t t-if = "docs.sorted(key=lambda r: r.id)[0].type_filtered == 'date_create'" >
                                    
                                    <t t-if = "doc.date_order >=  docs.sorted(key=lambda r: r.id)[0].date_filtered_wizard_init and doc.date_order &lt; docs.sorted(key=lambda r: r.id)[0].date_filtered_wizard_end " >
                                        <t t-if="doc.tasks_ids">
                                            <t t-set="num_ec" t-value="doc.tasks_ids[0].vehicle_id.x_studio_numero_economico" />
                                        </t>
                                        <t t-if="doc.invoice_ids">
                                            <t t-set="paid_status" t-value="doc.invoice_ids[0].payment_state"/>
                                        </t>
                                         <t t-foreach="doc.order_line" t-as="line">
                                            <t t-set="date_init" t-value="'Sin bitacora'"/>
                                            <t t-set="date_end" t-value="'Sin bitacora'"/>

                                            <t t-if="doc.tasks_ids and doc.tasks_ids[0].binacle_ids" t-set="date_init" t-value="doc.get_date_init(line)"/>
                                            <t t-if="doc.tasks_ids and doc.tasks_ids[0].binacle_ids" t-set="date_end" t-value="doc.get_date_end(line)"/>
                                            <tr>
                                                <td style = "border: 1px solid black;"><span t-field="doc.name"/></td>
                                                <td style = "border: 1px solid black;"> <span t-esc="num_ec"/> </td>
                                                <td style = "border: 1px solid black;"> <span t-field="doc.partner_id.name"/> </td>

                                                <td style = "border: 1px solid black;"> <span t-if="doc.tasks_ids" t-field="doc.tasks_ids[0].partner_id.x_studio_ubicacin"/> </td>
                                                <td style = "border: 1px solid black;"> <span  t-esc="date_init"/> </td>
                                                <td style = "border: 1px solid black;"> <span t-esc="date_end"/> </td>

                                                <td style = "border: 1px solid black;"><span t-if="doc.tasks_ids and doc.tasks_ids[0].binacle_ids" t-esc="doc.get_days_total(line)"/>    </td>
                                                <td style = "border: 1px solid black;"><span t-if="doc.tasks_ids and doc.tasks_ids[0].binacle_ids" t-esc="doc.get_total_hours(line)"/>    </td>
                                                <td style = "border: 1px solid black;"> <span t-field="line.name"/> </td>
                                                <td style = "border: 1px solid black;"> <span t-field="line.price_unit"/> </td>
                                                <td style = "border: 1px solid black;"> <span t-field="line.product_uom_qty"/> </td>
                                                <td style = "border: 1px solid black;"> <span t-field="line.price_subtotal"/> </td>
                                                <td style = "border: 1px solid black;"><span t-field="line.price_tax"/></td>
                                                <td style = "border: 1px solid black;"><span t-esc="line.price_tax + line.price_subtotal"/></td>
                                                <td style = "border: 1px solid black;"><span t-esc="doc.get_status_invoice_paid(paid_status)"/>  </td>
                                                <td style = "border: 1px solid black;"> <span t-field="doc.state"/> </td>
                                                <td style = "border: 1px solid black;"> <span t-if="doc.tasks_ids" t-field="doc.tasks_ids[0].stage_id.name"/></td>
                                                <td style = "border: 1px solid black;"><span t-esc="doc.get_names_users_assigned()"/></td>
                                                <td style = "border: 1px solid black;"><span t-esc="doc.get_names_users_assigned()"/></td>
                                                <td style = "border: 1px solid black;">  <span t-esc="line.product_id.minimum_quantity"/> </td>
                                            </tr>
                                        </t>
                                    </t>
                                    
                                </t>
                                
                                
                                <!--                                 fecha  ejecucion  -->
                                
                                <t t-if = "docs.sorted(key=lambda r: r.id)[0].type_filtered == 'date_ejec'" >
                                    <t t-if = "doc.tasks_ids[0].date_last_stage_update >=  docs.sorted(key=lambda r: r.id)[0].date_filtered_wizard_init and doc.tasks_ids[0].date_last_stage_update &lt; docs.sorted(key=lambda r: r.id)[0].date_filtered_wizard_end " >
                                        <t t-if="doc.tasks_ids">
                                            <t t-set="num_ec" t-value="doc.tasks_ids[0].vehicle_id.x_studio_numero_economico" />
                                        </t>
                                        <t t-if="doc.invoice_ids">
                                            <t t-set="paid_status" t-value="doc.invoice_ids[0].payment_state"/>
                                        </t>
                                        <t t-foreach="doc.order_line" t-as="line">
                                            <t t-set="date_init" t-value="'Sin bitacora'"/>
                                            <t t-set="date_end" t-value="'Sin bitacora'"/>

                                            <t t-if="doc.tasks_ids and doc.tasks_ids[0].binacle_ids" t-set="date_init" t-value="doc.get_date_init(line)"/>
                                        <t t-if="doc.tasks_ids and doc.tasks_ids[0].binacle_ids" t-set="date_end" t-value="doc.get_date_end(line)"/>
                                            <tr>
                                                <td style = "border: 1px solid black;"><span t-field="doc.name"/></td>
                                                <td style = "border: 1px solid black;"> <span t-esc="num_ec"/> </td>
                                                <td style = "border: 1px solid black;"> <span t-field="doc.partner_id.name"/> </td>

                                                <td style = "border: 1px solid black;"> <span t-if="doc.tasks_ids" t-field="doc.tasks_ids[0].partner_id.x_studio_ubicacin"/> </td>
                                                <td style = "border: 1px solid black;"> <span  t-esc="date_init"/> </td>
                                                <td style = "border: 1px solid black;"> <span t-esc="date_end"/> </td>

                                                <td style = "border: 1px solid black;"><span t-if="doc.tasks_ids and doc.tasks_ids[0].binacle_ids" t-esc="doc.get_days_total(line)"/>    </td>
                                                <td style = "border: 1px solid black;"><span t-if="doc.tasks_ids and doc.tasks_ids[0].binacle_ids" t-esc="doc.get_total_hours(line)"/>    </td>
                                                <td style = "border: 1px solid black;"> <span t-field="line.name"/> </td>
                                                <td style = "border: 1px solid black;"> <span t-field="line.price_unit"/> </td>
                                                <td style = "border: 1px solid black;"> <span t-field="line.product_uom_qty"/> </td>
                                                <td style = "border: 1px solid black;"> <span t-field="line.price_subtotal"/> </td>
                                                <td style = "border: 1px solid black;"><span t-field="line.price_tax"/></td>
                                                <td style = "border: 1px solid black;"><span t-esc="line.price_tax + line.price_subtotal"/></td>
                                                <td style = "border: 1px solid black;"><span t-esc="doc.get_status_invoice_paid(paid_status)"/>  </td>
                                                <td style = "border: 1px solid black;"> <span t-field="doc.state"/> </td>
                                                <td style = "border: 1px solid black;"> <span t-if="doc.tasks_ids" t-field="doc.tasks_ids[0].stage_id.name"/></td>
                                                <td style = "border: 1px solid black;"><span t-esc="doc.get_names_users_assigned()"/></td>
                                                <td style = "border: 1px solid black;"><span t-esc="doc.get_names_users_assigned()"/></td>
                                                <td style = "border: 1px solid black;">  <span t-esc="line.product_id.minimum_quantity"/> </td>
                                            </tr>
                                        </t>
                                    </t>
                                    
                                </t>
                                
                                
                                <t t-if = "docs.sorted(key=lambda r: r.id)[0].type_filtered == 'all'" >
                                    
                                    <!--t t-set="num_ec" t-value="doc.tasks_ids[0].vehicle_id.x_studio_numero_economico" /-->
                                    <t t-if="doc.invoice_ids">
                                        <t t-set="paid_status" t-value="doc.invoice_ids[0].payment_state"/>
                                    </t>
                                    <t t-foreach="doc.order_line" t-as="line">
                                        <t t-set="date_init" t-value="'Sin bitacora'"/>
                                        <t t-set="date_end" t-value="'Sin bitacora'"/>

                                        <t t-if="doc.tasks_ids and doc.tasks_ids[0].binacle_ids" t-set="date_init" t-value="doc.get_date_init(line)"/>
                                        <t t-if="doc.tasks_ids and doc.tasks_ids[0].binacle_ids" t-set="date_end" t-value="doc.get_date_end(line)"/>
                                        
                                        <tr>
                                            <td style = "border: 1px solid black;"><span t-field="doc.name"/></td>
                                            <td style = "border: 1px solid black;"> <span t-if="doc.tasks_ids" t-field="doc.tasks_ids[0].vehicle_id.x_studio_numero_economico"/> </td>
                                            <td style = "border: 1px solid black;"> <span t-field="doc.partner_id.name"/> </td>

                                            <td style = "border: 1px solid black;"> <span t-if="doc.tasks_ids" t-field="doc.tasks_ids[0].partner_id.x_studio_ubicacin"/> </td>
                                            <td style = "border: 1px solid black;"> <span  t-esc="date_init"/> </td>
                                            <td style = "border: 1px solid black;"> <span t-esc="date_end"/> </td>

                                            <td style = "border: 1px solid black;"><span t-if="doc.tasks_ids and doc.tasks_ids[0].binacle_ids" t-esc="doc.get_days_total(line)"/>    </td>
                                            <td style = "border: 1px solid black;"><span t-if="doc.tasks_ids and doc.tasks_ids[0].binacle_ids" t-esc="doc.get_total_hours(line)"/>    </td>
                                            <td style = "border: 1px solid black;"> <span t-field="line.name"/> </td>
                                            <td style = "border: 1px solid black;"> <span t-field="line.price_unit"/> </td>
                                            <td style = "border: 1px solid black;"> <span t-field="line.product_uom_qty"/> </td>
                                            <td style = "border: 1px solid black;"> <span t-field="line.price_subtotal"/> </td>
                                            <td style = "border: 1px solid black;"><span t-field="line.price_tax"/></td>
                                            <td style = "border: 1px solid black;"><span t-esc="line.price_tax + line.price_subtotal"/></td>
                                            <td style = "border: 1px solid black;"><span t-esc="doc.get_status_invoice_paid(paid_status)"/>  </td>
                                            <td style = "border: 1px solid black;"> <span t-field="doc.state"/> </td>
                                            <td style = "border: 1px solid black;"> <span t-if="doc.tasks_ids" t-field="doc.tasks_ids[0].stage_id.name"/></td>
                                            <td style = "border: 1px solid black;"><span t-esc="doc.get_names_users_assigned()"/></td>
                                            <td style = "border: 1px solid black;"><span t-esc="doc.get_names_users_assigned()"/></td>
                                            <td style = "border: 1px solid black;">  <span t-esc="line.product_id.minimum_quantity"/> </td>
                                        </tr>
                                    </t>
                                    
                                    
                                </t>
                                
                                
                            </t>
                            
                            
                            
                            
                        </tbody>
                    </table>
                    <br/>
                    <div class="row">
                        <div class = "col-12">
                            <h5 style = "text-align:center; font-weight: bold;">Fecha y hora de impresion : <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d %H:%M')"/> </h5>
                        </div>

                    </div>
                    
<!--                     <t t-foreach="docs" t-as="doc">
                        <h6>        hola que tal         </h6>
                    </t> -->
                </div>
            
            </t>
        </template>
        
        
        <template id="sale_order_cdd_template_report_task">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="doc">
                    <t t-call="gruascdd_report.sale_order_report_cdd_task"/>
                </t>
            </t>
        </template>
        
        <report 
            id="cdd_action_report_sale_task" 
            model="project.task" 
            string="Reporte para cliente"
            report_type="qweb-pdf"
            name="gruascdd_report.sale_order_cdd_template_report_task" 
            file="gruascdd_report.sale_order_cdd_template_report_task"
            print_report_name="'%s'%(object.name)"
        />
        
        
        <template id="sale_order_cdd_template_report_task_general">
            <t t-call="web.html_container">
                
                <t t-call="gruascdd_report.sale_order_report_cdd_task_2"/>
                
            </t>
        </template>
        
       
        <record id="cdd_action_report_sale_task_2" model="ir.actions.report">
            <field name="name">report</field>
            <field name="model">sale.order</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">gruascdd_report.sale_order_cdd_template_report_task_general</field>
            <field name="report_file">gruascdd_report.sale_order_cdd_template_report_task_general</field>
            <field name="print_report_name">'Inventory - %s' % (object.report_name)</field>
            <field name="binding_model_id" ref="model_sale_order"/>
            <field name="binding_type">report</field>
        </record>
        
        <record id="cdd_action_report_sale_task_2_xlsx" model="ir.actions.report">
            <field name="name">Exportar a Excel</field>
            <field name="model">sale.order</field>
            <field name="report_type">xlsx</field>
            <field name="report_name">project.task.xlsx</field>
            <field name="report_file">project.task.xlsx</field>
            <field name="print_report_name">'%s' % (object.report_name)</field>
            <field name="binding_model_id" ref="model_project_task"/>
            <field name="binding_type">report</field>
        </record>
        
        <record model="ir.actions.server" id="cna_action_report_task_all">
            <field name="name">cna.action.report.task.all</field>
            <field name="model_id" ref="model_sale_order"/>
            <field name="state">code</field>
            <field name="code">
                action = model.action_report_domain_2()
            </field>
        </record>
        
        <menuitem id="menu_menu_project_report" name="Resumen de actividades" parent="industry_fsm.fsm_menu_reporting" action="gruascdd_report.cna_action_report_task_all" sequence="10"/>
        
    </data>
</odoo>